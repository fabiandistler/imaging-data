---
title: "dev"
output: html_document
date: "2024-12-21"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidytable)
```

First load a single data set to see how the data structure looks like.
```{r}
file <- "CD27.160221.1535pro.mat"

df <- R.matlab::readMat(
  file
)
```

```{r}
df_clean <- tibble::tibble(
  time_ms = df[["scn"]][[3]][, 1],
  tone_one = unlist(df[["scn"]][[25]][1], use.names = FALSE),
  pupil_size = unlist(df[["scn"]][[2]], use.names = FALSE)[, 1],
  airpuff_on = unlist(df[["scn"]][[28]][1], use.names = FALSE),
  running_speed = unlist(df[["scn"]][[5]][[1]], use.names = FALSE)
)
```


```{r}
traces <- t(df[["caim"]][[15]]) |>
  # Create tibble with numeric column names
  tibble::as_tibble(, .name_repair = function(x) as.character(seq_along(x))) |>
  tidytable::pivot_longer(
    cols = tidytable::everything(),
    names_to = "component",
    values_to = "normalized_signal"
  )
```
